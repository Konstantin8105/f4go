C=DECK      POSTSETUPLIB
C
C  THIS IS THE POSTSETUP LIBRARY (SOURCE FILE)
C
C
C
C=DECK      POSTSETUP
      PROGRAM POSTS
C
C    INTERACTIVE INPUT FOR BOSOR5 POSTPROCESSOR...
C
#if hp700
$hp9000_800 intrinsics
#endif
      DIMENSION KPLOT(20),LPLOT(20)
      DIMENSION LSTEPS(100), TIMES(101), NTHMOD(100), NWAVES(100)
      COMMON/INDAT/INFILE
      CHARACTER*4 ANSOUT,CHARAC
      CHARACTER*28 CASE
      CHARACTER*32 VNAM2
      LOGICAL ANSL1
      common/case/casename
      character*28 casename
      character*32 fname
#if cnvx
      external signal_handler
      integer dummying, signal
      dummyint = signal(2, signal_handler, -1)
#endif
#if sgi
      integer signal_handler
      external signal_handler
      integer dummyint, signal
      dummyint = signal(2, signal_handler, -1)
#endif
#if star
      integer signal_handler
      external signal_handler
      call signal(2, signal_handler)
#endif
C
C BEG FEB 2009
#if hp700
C     call getarg(2, casename)
      call getarg(1, casename)
#else
      call getarg(1,casename)
#endif
C END FEB 2009
      IOUT = 10
      IFILE = 2
      INFILE = 5
      IFILE3 = 7
C
      CASE = casename
C
      I=INDEX(CASE,' ')
      IF (I.NE.0) THEN
         VNAM2=CASE(:I-1)//'.IPP'
      ELSE
         VNAM2=CASE//'.IPP'
      ENDIF 
C
C FOLLOWING USED FOR VAX/VMS..
c     OPEN(UNIT=IFILE,FILE='BOSOR5:PROMPT.DAT',STATUS='OLD',READONLY)
c     OPEN(UNIT=4,FILE='BOSOR5:PROMPT2.DAT',STATUS='OLD',READONLY)
c     OPEN(UNIT=IFILE3,FILE='BOSOR5:PROMPT3.DAT',STATUS='OLD',READONLY)
C END VAX/VMS OPEN STATEMENTS
C
C FOLLOWING USED FOR UNIX...
      OPEN(UNIT=IFILE,FILE='PROMPT.DAT',STATUS='OLD')
      OPEN(UNIT=4,FILE='PROMPT2.DAT',STATUS='OLD')
      OPEN(UNIT=IFILE3,FILE='PROMPT3.DAT',STATUS='OLD')
#if rs6k
      rewind(IFILE)
      rewind(4)
      rewind(IFILE3)
#endif
C END UNIX OPEN STATEMENTS
C
      CALL REREAD(IOUT,IFILE3,INFILE,VNAM2)
C     
C
      CALL DATUM(IFILE,200,0,0,INT,REALL,CHARAC,IOUT,0,1)
      CALL DATUM(IFILE,210,1,2,IPRINT,REALL,CHARAC,IOUT,0,1)
      CALL DATUM(IFILE,220,1,2,IPLOT,REALL,CHARAC,IOUT,0,1)
      CALL DATUM(IFILE,223,1,2,NLAST,REALL,CHARAC,IOUT,0,1)
      CALL DATUM(IFILE,224,1,1,INT,REALL,ANSOUT,IOUT,0,1)
      IF (NLAST.GT.-1) CALL BLOWUP(IFILE3,IOUT,JPLOT,KPLOT,LPLOT)
C
      REWIND IFILE
      IF (IPRINT.EQ.1.OR.IPRINT.EQ.3) GO TO 40
      IF (IPLOT.EQ.1.OR.IPLOT.EQ.3) GO TO 40
      GO TO 60
   40 CONTINUE
C
      CALL DATUM(IFILE,225,0,0,INT,REALL,CHARAC,IOUT,0,1)
      CALL DATUM(IFILE,230,1,2,NSTEPS,REALL,CHARAC,IOUT,0,1)
      IF (NSTEPS.EQ.0) GO TO 90
C
      DO 45 I = 1,NSTEPS
      IPROMP = 1
      IF (I.GT.1) IPROMP = 0
      CALL DATUM(IFILE,240,1,1,LSTEPS(I),REALL,CHARAC,IOUT,0,IPROMP)
   45 CONTINUE
C
      DO 46 I = 1,NSTEPS
      IPROMP = 1
      IF (I.GT.1) IPROMP = 0
      CALL DATUM(IFILE,250,1,1,INT,TIMES(I),CHARAC,IOUT,I,IPROMP)
   46 CONTINUE
C
      CALL DATUM(IFILE,260,1,2,ISOG,REALL,CHARAC,IOUT,0,1)
C
      CALL DATUM(IFILE,270,1,2,INT,FMAX,CHARAC,IOUT,0,1)
C
      CALL DATUM(IFILE,271,1,1,INT,REALL,ANSOUT,IOUT,0,1)
      IF (ANSL1('Y',ANSOUT,INFILE)) GO TO 52
      CALL DATUM(IFILE,272,1,1,NSEGS,REALL,CHARAC,IOUT,0,1)
      DO 49 I = 1,NSEGS
      REWIND IFILE
      CALL DATUM(IFILE,273,1,1,INT,REALL,ANSOUT,IOUT,I,1)
      IF (ANSL1('N',ANSOUT,INFILE)) GO TO 49
      CALL DATUM(IFILE,274,1,1,INT,REALL,ANSOUT,IOUT,I,1)
      IF (ANSL1('Y',ANSOUT,INFILE)) GO TO 49
      CALL DATUM(IFILE,275,0,0,INT,REALL,CHARAC,IOUT,0,1)
      CALL DATUM(IFILE,276,1,1,INODMN,REALL,CHARAC,IOUT,I,1)
      CALL DATUM(IFILE,277,1,1,INODMX,REALL,CHARAC,IOUT,I,1)
   49 CONTINUE
   52 CONTINUE
C
   60 CONTINUE
C
      IF (IPRINT.EQ.2.OR.IPRINT.EQ.3) GO TO 70
      IF (IPLOT.EQ.2.OR.IPLOT.EQ.3) GO TO 70
      GO TO 90
C
   70 CONTINUE
C
      CALL DATUM(IFILE,280,0,0,INT,REALL,CHARAC,IOUT,0,1)
      CALL DATUM(IFILE,290,1,2,NMODES,REALL,CHARAC,IOUT,0,1)
C
      DO 75 I = 1,NMODES
      IPROMP = 1
      IF (I.GT.1) IPROMP = 0
      CALL DATUM(IFILE,300,1,2,NTHMOD(I),REALL,CHARAC,IOUT,I,IPROMP)
   75 CONTINUE
C
      DO 76 I = 1,NMODES
      IPROMP = 1
      IF (I.GT.1) IPROMP = 0
      CALL DATUM(IFILE,310,1,2,NWAVES(I),REALL,CHARAC,IOUT,I,IPROMP)
   76 CONTINUE
C
      CALL DATUM(IFILE,320,1,1,INT,REALL,ANSOUT,IOUT,0,1)
      IF (ANSL1('Y',ANSOUT,INFILE)) GO TO 82
      CALL DATUM(IFILE,330,1,1,NSEGS,REALL,CHARAC,IOUT,0,1)
      DO 79 I = 1,NSEGS
      REWIND IFILE
      CALL DATUM(IFILE,340,1,1,INT,REALL,ANSOUT,IOUT,I,1)
      IF (ANSL1('N',ANSOUT,INFILE)) GO TO 79
      CALL DATUM(IFILE,350,1,1,INT,REALL,ANSOUT,IOUT,I,1)
      IF (ANSL1('Y',ANSOUT,INFILE)) GO TO 79
      CALL DATUM(IFILE,360,0,0,INT,REALL,CHARAC,IOUT,0,1)
      CALL DATUM(IFILE,370,1,1,INODMN,REALL,CHARAC,IOUT,I,1)
      CALL DATUM(IFILE,380,1,1,INODMX,REALL,CHARAC,IOUT,I,1)
   79 CONTINUE
   82 CONTINUE
C
   90 CONTINUE
C
      WRITE(6,196)
  196 FORMAT(/' Next, give the command BOSORPOST'/)
      END
C
C
C
C=DECK      BLOWUP
      SUBROUTINE BLOWUP(IFILE3,IOUT,JPLOT,KPLOT,LPLOT)
C     
C     PURPOSE IS TO ALLOW USER TO PROVIDE LOCATIONS AND FACTORS FOR
C     EXPANDED PLOTS OF UNDEFORMED AND DEFORMED STRUCTURE.  
C     
      COMMON/INDAT/INFILE     
      DIMENSION LPLOT(*),KPLOT(*)   
      LOGICAL ANSL1     
      CHARACTER*4 ANSWER
C     
      JPLOT = 0   
      DO 10 I = 1,20    
      LPLOT(I) = 0
      KPLOT(I) = 0
   10 CONTINUE    
C     
      REWIND IFILE3     
      CALL DATUM(IFILE3,500,0,0,INT,REALL,CHARAC,IOUT,0,1)  
      CALL DATUM(IFILE3,510,1,1,INT,REALL,ANSWER,IOUT,0,1)  
      IF (ANSL1('N',ANSWER,INFILE)) GO TO 100   
   20 CONTINUE    
      JPLOT = JPLOT + 1 
      REWIND IFILE3     
      IF (JPLOT.GT.1)   
     1      CALL DATUM(IFILE3,520,1,1,INT,REALL,ANSWER,IOUT,0,1)  
      IF (ANSL1('N',ANSWER,INFILE)) GO TO 100   
      CALL DATUM(IFILE3,530,1,2,ISEG,REALL,CHARAC,IOUT,0,1) 
      KPLOT(JPLOT) = ISEG*1000 + 1  
   22 CONTINUE
      CALL DATUM(IFILE3,540,1,2,LPLOT(JPLOT),REALL,CHARAC,IOUT,0,1)     
      IF (LPLOT(JPLOT).LT.1) THEN
         WRITE(6,*)' IMPROPER MAGNIFICATION FACTOR. USE INTEGER > 1 '
         BACKSPACE(IOUT)
         REWIND IFILE3
         GO TO 22
      ENDIF
      GO TO 20    
  100 CONTINUE    
      IF (JPLOT.GT.0) JPLOT = JPLOT - 1   
      RETURN
      END   
