IMPLICIT            	implicit
IDENT               	none
NEW_LINE            	

INTEGER             	integer
IDENT               	M
,                   	,
IDENT               	numprimes
NEW_LINE            	

INTEGER             	integer
IDENT               	MAXPRIMES
NEW_LINE            	

NEW_LINE            	

IDENT               	parameter
(                   	(
IDENT               	MAXPRIMES
=                   	=
INT                 	10000
)                   	)
NEW_LINE            	

INTEGER             	integer
IDENT               	primes
(                   	(
IDENT               	MAXPRIMES
)                   	)
NEW_LINE            	

INTEGER             	integer
IDENT               	makeprimes
NEW_LINE            	

NEW_LINE            	

IDENT               	write
(                   	(
*                   	*
,                   	,
*                   	*
)                   	)
STRING              	'Enter ceiling on primes'
NEW_LINE            	

IDENT               	read
(                   	(
*                   	*
,                   	,
*                   	*
)                   	)
IDENT               	M
NEW_LINE            	

NEW_LINE            	

COMMENT             	C Get list of primes up to M
NEW_LINE            	

IDENT               	numprimes
=                   	=
IDENT               	makeprimes
(                   	(
IDENT               	primes
,                   	,
IDENT               	M
,                   	,
IDENT               	MAXPRIMES
)                   	)
NEW_LINE            	

NEW_LINE            	

COMMENT             	C Print the primes
NEW_LINE            	

CALL                	call
IDENT               	printarray
(                   	(
STRING              	'Primes'
,                   	,
IDENT               	primes
,                   	,
IDENT               	numprimes
)                   	)
NEW_LINE            	

NEW_LINE            	

END                 	end
NEW_LINE            	

NEW_LINE            	

SUBROUTINE          	subroutine
IDENT               	printarray
(                   	(
IDENT               	heading
,                   	,
IDENT               	a
,                   	,
IDENT               	n
)                   	)
NEW_LINE            	

IMPLICIT            	implicit
IDENT               	none
NEW_LINE            	

IDENT               	character
*                   	*
(                   	(
*                   	*
)                   	)
IDENT               	heading
NEW_LINE            	

INTEGER             	integer
IDENT               	i
,                   	,
IDENT               	n
,                   	,
IDENT               	a
(                   	(
INT                 	1
)                   	)
NEW_LINE            	

IDENT               	write
(                   	(
*                   	*
,                   	,
*                   	*
)                   	)
IDENT               	heading
NEW_LINE            	

DO                  	do
IDENT               	i
=                   	=
INT                 	1
,                   	,
IDENT               	n
NEW_LINE            	

IDENT               	write
(                   	(
*                   	*
,                   	,
STRING              	'(1x,i4,1x,i5)'
)                   	)
IDENT               	i
,                   	,
IDENT               	a
(                   	(
IDENT               	i
)                   	)
NEW_LINE            	

END                 	end
DO                  	do
NEW_LINE            	

END                 	end
NEW_LINE            	

NEW_LINE            	

INTEGER             	integer
FUNCTION            	function
IDENT               	makeprimes
(                   	(
IDENT               	p
,                   	,
IDENT               	n
,                   	,
IDENT               	max
)                   	)
NEW_LINE            	

COMMENT             	C computes array of primes less than or equal to n.
NEW_LINE            	

COMMENT             	C note: max = limit of number of primes, must be at least 1.
NEW_LINE            	

IMPLICIT            	implicit
IDENT               	none
NEW_LINE            	

INTEGER             	integer
IDENT               	n
,                   	,
IDENT               	max
,                   	,
IDENT               	p
(                   	(
IDENT               	max
)                   	)
NEW_LINE            	

INTEGER             	integer
IDENT               	i
,                   	,
IDENT               	numprimes
NEW_LINE            	

IDENT               	logical
IDENT               	divisible
NEW_LINE            	

COMMENT             	C put the even prime into the list
NEW_LINE            	

IDENT               	numprimes
=                   	=
INT                 	1
NEW_LINE            	

IDENT               	p
(                   	(
IDENT               	numprimes
)                   	)
=                   	=
INT                 	2
NEW_LINE            	

COMMENT             	C loop thru odd integers, testing if divisible
NEW_LINE            	

DO                  	do
IDENT               	i
=                   	=
INT                 	3
,                   	,
IDENT               	n
,                   	,
INT                 	2
NEW_LINE            	

if                  	if
(                   	(
!=                  	.not.
IDENT               	divisible
(                   	(
IDENT               	i
,                   	,
IDENT               	p
,                   	,
IDENT               	numprimes
)                   	)
)                   	)
THEN                	then
NEW_LINE            	

IDENT               	numprimes
=                   	=
IDENT               	numprimes
+                   	+
INT                 	1
NEW_LINE            	

if                  	if
(                   	(
IDENT               	numprimes
>                   	.gt.
IDENT               	max
)                   	)
THEN                	then
NEW_LINE            	

IDENT               	write
(                   	(
*                   	*
,                   	,
*                   	*
)                   	)
STRING              	'Ran out of space at p='
,                   	,
IDENT               	i
NEW_LINE            	

IDENT               	stop
NEW_LINE            	

else                	else
NEW_LINE            	

IDENT               	p
(                   	(
IDENT               	numprimes
)                   	)
=                   	=
IDENT               	i
NEW_LINE            	

END                 	end
if                  	if
NEW_LINE            	

END                 	end
if                  	if
NEW_LINE            	

END                 	end
DO                  	do
NEW_LINE            	

COMMENT             	C return number of primes found
NEW_LINE            	

IDENT               	makeprimes
=                   	=
IDENT               	numprimes
NEW_LINE            	

return              	return
NEW_LINE            	

END                 	end
NEW_LINE            	

IDENT               	logical
FUNCTION            	function
IDENT               	divisible
(                   	(
IDENT               	n
,                   	,
IDENT               	p
,                   	,
IDENT               	nump
)                   	)
NEW_LINE            	

IMPLICIT            	implicit
IDENT               	none
NEW_LINE            	

INTEGER             	integer
IDENT               	n
,                   	,
IDENT               	nump
,                   	,
IDENT               	p
(                   	(
INT                 	1
)                   	)
NEW_LINE            	

INTEGER             	integer
IDENT               	i
NEW_LINE            	

DO                  	do
IDENT               	i
=                   	=
INT                 	1
,                   	,
IDENT               	nump
NEW_LINE            	

if                  	if
(                   	(
IDENT               	mod
(                   	(
IDENT               	n
,                   	,
IDENT               	p
(                   	(
IDENT               	i
)                   	)
)                   	)
==                  	.eq.
INT                 	0
)                   	)
THEN                	then
NEW_LINE            	

IDENT               	divisible
=                   	=
IDENT               	.true.
NEW_LINE            	

return              	return
NEW_LINE            	

END                 	end
if                  	if
NEW_LINE            	

END                 	end
DO                  	do
NEW_LINE            	

IDENT               	divisible
=                   	=
.                   	.
IDENT               	e
.                   	.
return              	return
NEW_LINE            	

END                 	end
NEW_LINE            	

