 SUBROUTINE DTBSV ( UPLO , TRANS , DIAG , N , K , A , LDA , X , INCX )
 INTEGER INCX , K , LDA , N
 CHARACTER DIAG , TRANS , UPLO
 DOUBLE PRECISION A ( LDA , * ) , X ( * )
 DOUBLE PRECISION ZERO
 PARAMETER ( ZERO = 0.0D+0 )
 DOUBLE PRECISION TEMP
 INTEGER I , INFO , IX , J , JX , KPLUS1 , KX , L
 LOGICAL NOUNIT
 LOGICAL LSAME
 EXTERNAL LSAME
 EXTERNAL XERBLA
 INTRINSIC MAX , MIN
 INFO = 0
 IF ( .NOT. LSAME ( UPLO , 'U' ) .AND. .NOT. LSAME ( UPLO , 'L' ) ) THEN
 INFO = 1
 ELSE IF ( .NOT. LSAME ( TRANS , 'N' ) .AND. .NOT. LSAME ( TRANS , 'T' ) .AND.
 + .NOT. LSAME ( TRANS , 'C' ) ) THEN
 INFO = 2
 ELSE IF ( .NOT. LSAME ( DIAG , 'U' ) .AND. .NOT. LSAME ( DIAG , 'N' ) ) THEN
 INFO = 3
 ELSE IF ( N .LT. 0 ) THEN
 INFO = 4
 ELSE IF ( K .LT. 0 ) THEN
 INFO = 5
 ELSE IF ( LDA .LT. ( K + 1 ) ) THEN
 INFO = 7
 ELSE IF ( INCX .EQ. 0 ) THEN
 INFO = 9
 END IF
 IF ( INFO .NE. 0 ) THEN
 CALL XERBLA ( 'DTBSV ' , INFO )
 RETURN
 END IF
 IF ( N .EQ. 0 ) RETURN
 NOUNIT = LSAME ( DIAG , 'N' )
 IF ( INCX .LE. 0 ) THEN
 KX = 1 - ( N - 1 ) * INCX
 ELSE IF ( INCX .NE. 1 ) THEN
 KX = 1
 END IF
 IF ( LSAME ( TRANS , 'N' ) ) THEN
 IF ( LSAME ( UPLO , 'U' ) ) THEN
 KPLUS1 = K + 1
 IF ( INCX .EQ. 1 ) THEN
 DO 20 J = N , 1 , - 1
 IF ( X ( J ) .NE. ZERO ) THEN
 L = KPLUS1 - J
 IF ( NOUNIT ) X ( J ) = X ( J ) / A ( KPLUS1 , J )
 TEMP = X ( J )
 DO 10 I = J - 1 , MAX ( 1 , J - K ) , - 1
 X ( I ) = X ( I ) - TEMP * A ( L + I , J )
 10 CONTINUE
 END IF
 20 CONTINUE
 ELSE
 KX = KX + ( N - 1 ) * INCX
 JX = KX
 DO 40 J = N , 1 , - 1
 KX = KX - INCX
 IF ( X ( JX ) .NE. ZERO ) THEN
 IX = KX
 L = KPLUS1 - J
 IF ( NOUNIT ) X ( JX ) = X ( JX ) / A ( KPLUS1 , J )
 TEMP = X ( JX )
 DO 30 I = J - 1 , MAX ( 1 , J - K ) , - 1
 X ( IX ) = X ( IX ) - TEMP * A ( L + I , J )
 IX = IX - INCX
 30 CONTINUE
 END IF
 JX = JX - INCX
 40 CONTINUE
 END IF
 ELSE
 IF ( INCX .EQ. 1 ) THEN
 DO 60 J = 1 , N
 IF ( X ( J ) .NE. ZERO ) THEN
 L = 1 - J
 IF ( NOUNIT ) X ( J ) = X ( J ) / A ( 1 , J )
 TEMP = X ( J )
 DO 50 I = J + 1 , MIN ( N , J + K )
 X ( I ) = X ( I ) - TEMP * A ( L + I , J )
 50 CONTINUE
 END IF
 60 CONTINUE
 ELSE
 JX = KX
 DO 80 J = 1 , N
 KX = KX + INCX
 IF ( X ( JX ) .NE. ZERO ) THEN
 IX = KX
 L = 1 - J
 IF ( NOUNIT ) X ( JX ) = X ( JX ) / A ( 1 , J )
 TEMP = X ( JX )
 DO 70 I = J + 1 , MIN ( N , J + K )
 X ( IX ) = X ( IX ) - TEMP * A ( L + I , J )
 IX = IX + INCX
 70 CONTINUE
 END IF
 JX = JX + INCX
 80 CONTINUE
 END IF
 END IF
 ELSE
 IF ( LSAME ( UPLO , 'U' ) ) THEN
 KPLUS1 = K + 1
 IF ( INCX .EQ. 1 ) THEN
 DO 100 J = 1 , N
 TEMP = X ( J )
 L = KPLUS1 - J
 DO 90 I = MAX ( 1 , J - K ) , J - 1
 TEMP = TEMP - A ( L + I , J ) * X ( I )
 90 CONTINUE
 IF ( NOUNIT ) TEMP = TEMP / A ( KPLUS1 , J )
 X ( J ) = TEMP
 100 CONTINUE
 ELSE
 JX = KX
 DO 120 J = 1 , N
 TEMP = X ( JX )
 IX = KX
 L = KPLUS1 - J
 DO 110 I = MAX ( 1 , J - K ) , J - 1
 TEMP = TEMP - A ( L + I , J ) * X ( IX )
 IX = IX + INCX
 110 CONTINUE
 IF ( NOUNIT ) TEMP = TEMP / A ( KPLUS1 , J )
 X ( JX ) = TEMP
 JX = JX + INCX
 IF ( J .GT. K ) KX = KX + INCX
 120 CONTINUE
 END IF
 ELSE
 IF ( INCX .EQ. 1 ) THEN
 DO 140 J = N , 1 , - 1
 TEMP = X ( J )
 L = 1 - J
 DO 130 I = MIN ( N , J + K ) , J + 1 , - 1
 TEMP = TEMP - A ( L + I , J ) * X ( I )
 130 CONTINUE
 IF ( NOUNIT ) TEMP = TEMP / A ( 1 , J )
 X ( J ) = TEMP
 140 CONTINUE
 ELSE
 KX = KX + ( N - 1 ) * INCX
 JX = KX
 DO 160 J = N , 1 , - 1
 TEMP = X ( JX )
 IX = KX
 L = 1 - J
 DO 150 I = MIN ( N , J + K ) , J + 1 , - 1
 TEMP = TEMP - A ( L + I , J ) * X ( IX )
 IX = IX - INCX
 150 CONTINUE
 IF ( NOUNIT ) TEMP = TEMP / A ( 1 , J )
 X ( JX ) = TEMP
 JX = JX - INCX
 IF ( ( N - J ) .GE. K ) KX = KX - INCX
 160 CONTINUE
 END IF
 END IF
 END IF
 RETURN
 END
