 SUBROUTINE CTPSV ( UPLO , TRANS , DIAG , N , AP , X , INCX )
 INTEGER INCX , N
 CHARACTER DIAG , TRANS , UPLO
 COMPLEX AP ( * ) , X ( * )
 COMPLEX ZERO


 ZERO = ( 0.0E+0 , 0.0E+0 )

 COMPLEX TEMP
 INTEGER I , INFO , IX , J , JX , K , KK , KX
 LOGICAL NOCONJ , NOUNIT
 LOGICAL LSAME
 EXTERNAL LSAME
 EXTERNAL XERBLA
 INTRINSIC CONJG
 INFO = 0
 IF ( .NOT. LSAME ( UPLO , 'U' ) .AND. .NOT. LSAME ( UPLO , 'L' ) ) THEN
 INFO = 1
 ELSE IF ( .NOT. LSAME ( TRANS , 'N' ) .AND. .NOT. LSAME ( TRANS , 'T' ) .AND. .NOT. LSAME ( TRANS , 'C' ) ) THEN
 INFO = 2
 ELSE IF ( .NOT. LSAME ( DIAG , 'U' ) .AND. .NOT. LSAME ( DIAG , 'N' ) ) THEN
 INFO = 3
 ELSE IF ( N .LT. 0 ) THEN
 INFO = 4
 ELSE IF ( INCX .EQ. 0 ) THEN
 INFO = 7
 END
 IF ( INFO .NE. 0 ) THEN
 CALL XERBLA ( 'CTPSV ' , INFO )
 RETURN
 END
 IF ( N .EQ. 0 ) RETURN
 NOCONJ = LSAME ( TRANS , 'T' )
 NOUNIT = LSAME ( DIAG , 'N' )
 IF ( INCX .LE. 0 ) THEN
 KX = 1 - ( N - 1 ) * INCX
 ELSE IF ( INCX .NE. 1 ) THEN
 KX = 1
 END
 IF ( LSAME ( TRANS , 'N' ) ) THEN
 IF ( LSAME ( UPLO , 'U' ) ) THEN
 KK = ( N * ( N + 1 ) ) / 2
 IF ( INCX .EQ. 1 ) THEN
 DO J = N , 1 , - 1
 IF ( X ( J ) .NE. ZERO ) THEN
 IF ( NOUNIT ) X ( J ) = X ( J ) / AP ( KK )
 TEMP = X ( J )
 K = KK - 1
 DO I = J - 1 , 1 , - 1
 X ( I ) = X ( I ) - TEMP * AP ( K )
 K = K - 1
 end

 END
 KK = KK - J
 end

 ELSE
 JX = KX + ( N - 1 ) * INCX
 DO J = N , 1 , - 1
 IF ( X ( JX ) .NE. ZERO ) THEN
 IF ( NOUNIT ) X ( JX ) = X ( JX ) / AP ( KK )
 TEMP = X ( JX )
 IX = JX
 DO K = KK - 1 , KK - J + 1 , - 1
 IX = IX - INCX
 X ( IX ) = X ( IX ) - TEMP * AP ( K )
 end

 END
 JX = JX - INCX
 KK = KK - J
 end

 END
 ELSE
 KK = 1
 IF ( INCX .EQ. 1 ) THEN
 DO J = 1 , N
 IF ( X ( J ) .NE. ZERO ) THEN
 IF ( NOUNIT ) X ( J ) = X ( J ) / AP ( KK )
 TEMP = X ( J )
 K = KK + 1
 DO I = J + 1 , N
 X ( I ) = X ( I ) - TEMP * AP ( K )
 K = K + 1
 end

 END
 KK = KK + ( N - J + 1 )
 end

 ELSE
 JX = KX
 DO J = 1 , N
 IF ( X ( JX ) .NE. ZERO ) THEN
 IF ( NOUNIT ) X ( JX ) = X ( JX ) / AP ( KK )
 TEMP = X ( JX )
 IX = JX
 DO K = KK + 1 , KK + N - J
 IX = IX + INCX
 X ( IX ) = X ( IX ) - TEMP * AP ( K )
 end

 END
 JX = JX + INCX
 KK = KK + ( N - J + 1 )
 end

 END
 END
 ELSE
 IF ( LSAME ( UPLO , 'U' ) ) THEN
 KK = 1
 IF ( INCX .EQ. 1 ) THEN
 DO J = 1 , N
 TEMP = X ( J )
 K = KK
 IF ( NOCONJ ) THEN
 DO I = 1 , J - 1
 TEMP = TEMP - AP ( K ) * X ( I )
 K = K + 1
 end

 IF ( NOUNIT ) TEMP = TEMP / AP ( KK + J - 1 )
 ELSE
 DO I = 1 , J - 1
 TEMP = TEMP - CONJG ( AP ( K ) ) * X ( I )
 K = K + 1
 end

 IF ( NOUNIT ) TEMP = TEMP / CONJG ( AP ( KK + J - 1 ) )
 END
 X ( J ) = TEMP
 KK = KK + J
 end

 ELSE
 JX = KX
 DO J = 1 , N
 TEMP = X ( JX )
 IX = KX
 IF ( NOCONJ ) THEN
 DO K = KK , KK + J - 2
 TEMP = TEMP - AP ( K ) * X ( IX )
 IX = IX + INCX
 end

 IF ( NOUNIT ) TEMP = TEMP / AP ( KK + J - 1 )
 ELSE
 DO K = KK , KK + J - 2
 TEMP = TEMP - CONJG ( AP ( K ) ) * X ( IX )
 IX = IX + INCX
 end

 IF ( NOUNIT ) TEMP = TEMP / CONJG ( AP ( KK + J - 1 ) )
 END
 X ( JX ) = TEMP
 JX = JX + INCX
 KK = KK + J
 end

 END
 ELSE
 KK = ( N * ( N + 1 ) ) / 2
 IF ( INCX .EQ. 1 ) THEN
 DO J = N , 1 , - 1
 TEMP = X ( J )
 K = KK
 IF ( NOCONJ ) THEN
 DO I = N , J + 1 , - 1
 TEMP = TEMP - AP ( K ) * X ( I )
 K = K - 1
 end

 IF ( NOUNIT ) TEMP = TEMP / AP ( KK - N + J )
 ELSE
 DO I = N , J + 1 , - 1
 TEMP = TEMP - CONJG ( AP ( K ) ) * X ( I )
 K = K - 1
 end

 IF ( NOUNIT ) TEMP = TEMP / CONJG ( AP ( KK - N + J ) )
 END
 X ( J ) = TEMP
 KK = KK - ( N - J + 1 )
 end

 ELSE
 KX = KX + ( N - 1 ) * INCX
 JX = KX
 DO J = N , 1 , - 1
 TEMP = X ( JX )
 IX = KX
 IF ( NOCONJ ) THEN
 DO K = KK , KK - ( N - ( J + 1 ) ) , - 1
 TEMP = TEMP - AP ( K ) * X ( IX )
 IX = IX - INCX
 end

 IF ( NOUNIT ) TEMP = TEMP / AP ( KK - N + J )
 ELSE
 DO K = KK , KK - ( N - ( J + 1 ) ) , - 1
 TEMP = TEMP - CONJG ( AP ( K ) ) * X ( IX )
 IX = IX - INCX
 end

 IF ( NOUNIT ) TEMP = TEMP / CONJG ( AP ( KK - N + J ) )
 END
 X ( JX ) = TEMP
 JX = JX - INCX
 KK = KK - ( N - J + 1 )
 end

 END
 END
 END
 RETURN
 END
